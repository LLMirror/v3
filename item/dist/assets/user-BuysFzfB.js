import{S as Se,a as Ue,u as Be,r as k,v as Ae,N as Fe,X as Ie,H as $e,ap as ze,b as s,d as Pe,o as i,c as S,f as t,h as o,g as n,k as d,l as z,z as p,x as qe,O as T,M as Ee,F as K,C as X,A as G,e as f,E as De,t as Me,K as J,aq as Ne,s as Q,ar as Re,as as He,a7 as Le,at as Oe,au as U,av as B,aw as je,ax as Ke,ay as Xe,az as Ge,aA as Je,aB as Qe}from"./index-Dom6VubR.js";import{F as We}from"./FileList-CrgAZes-.js";import{m as W}from"./md5-Dj8Aq7FI.js";import{U as Ye}from"./UsePagination-DJeUD4p2.js";import"./index-Cp-ThHdC.js";import"./index-AsNyoiPZ.js";import"./vuedraggable.umd-DILWhdXN.js";const Ze={class:"app-container table-height-auto"},el={class:"dialog-footer"},ll=f("div",{class:"color-title"},"默认背景",-1),tl=f("div",{class:"color-title"},"展开背景",-1),ol=f("div",{class:"color-title"},"默认文字",-1),al=f("div",{class:"color-title"},"选中文字",-1),nl=f("div",{class:"color-title"},"当前选中展开文字",-1),rl=f("div",{class:"color-title"},"hover背景",-1),sl=f("div",{class:"color-title"},"el主题背景",-1),il=f("div",{class:"color-title"},"el主题文字",-1),ul={class:"dialog-footer"},dl=De({name:"User"}),Vl=Object.assign(dl,{setup(ml){const{initData:Y,dataList:Z,pageSearch:ee,total:M,pageConfig:A,tableLoading:le,pageRefresh:F}=Ye(),N=Se(),{proxy:g}=Me();Ue();const te=Be(),V=k(!1),y=k(!1),w=k(!1);k("");const R=k([]),I=k([]),oe=k([]),ae=k(null),ne=Ae(()=>[{label:"用户名称",prop:"name",type:"FormInput",placeholder:"请输入用户名称"},{label:"账号归属",prop:"moreId",type:"FormSelect",options:I.value,keyLabel:"name",keyValue:"id",placeholder:"请选择账号归属"},{label:"状态",prop:"status",type:"FormSelect",options:[{label:"正常",id:1},{label:"禁用",id:0}],keyValue:"id",placeholder:"请选择状态"}]),re=Fe({form:{},rules:{name:[{required:!0,message:"请输入用户名称",trigger:"blur"},{min:2,max:15,message:"长度在 2 到 15 个字符",trigger:"blur"}],pwd:[{required:!0,message:"请输入用户密码",trigger:"blur"},{min:6,max:15,message:"长度在 6 到 15 个字符",trigger:"blur"}],rolesId:[{required:!0,message:"请选择用户角色",trigger:"change"}],moreId:[{required:!0,message:"请选择归属账号",trigger:"change"}],status:[{required:!0,message:"请选择状态",trigger:"change"}],url:[{required:!0,message:"请上传用户头像！",trigger:"blur"}]}}),{form:a,rules:se}=Ie(re);function ie(){V.value=!0,a.value={},J(()=>{ae.value.clearFiles()})}function ue(r){V.value=!0,a.value={...r,rolesId:r.rolesId.split(",")},J(()=>{oe.value=[{name:r.url,url:r.url}]})}async function de(){await g.$refs.ruleForm.validate();try{w.value=!0;const r={...a.value,rolesId:a.value.rolesId.join(",")};!a.value.id&&await Ne({...r,pwd:W(Q()+r.pwd)}),a.value.id&&await Re(r),g.$modal.msgSuccess(a.value.id?"修改成功":"新增成功"),V.value=!1,F()}finally{w.value=!1}}async function me(r){await g.$modal.confirm(`是否删除用户：${r.name}？`),await He({id:r.id}),F(),g.$modal.msgSuccess("删除成功")}async function pe(r){let{name:l,admin:v}=r;const{value:u}=await Le.prompt(v===1?"当前修改的是《总管理》密码，请务必再次确认！":`当前修改的是《${l}》密码`,"温馨提示",{confirmButtonText:"确定修改",cancelButtonText:"取消",inputPattern:/.{6,15}/,inputErrorMessage:"密码6-15位密码"});await Oe({id:r.id,pwd:W(Q()+u)}),g.$modal.msgSuccess("修改成功"),v===1&&N.logOut().then(()=>{try{location.href=te.fullPath||"/index"}catch{location.href="/index"}})}function ce(r){r.elTheme===1&&(U(r.elBg),B(r.elText)),y.value=!0,a.value={...r}}async function fe(){try{w.value=!0,await je(a.value),F(),g.$modal.msgSuccess("修改成功"),y.value=!1}finally{w.value=!1}}function x(r,l){document.getElementsByTagName("body")[0].style.setProperty(l,r)}function H(r,l){l===1&&U(r),l===2&&B(r)}function ge(r){r===1?(U(a.value.elBg),B(a.value.elText)):(U(Ke().theme),B("#FFF"))}function ve(){N.getInfo()}async function _e(){const{data:r}=await Xe(),{menuBg:l,menuHoverBg:v,menuActiveText:u,menuSubActiveText:m,menuSubBg:C,menuText:h}=r[0];Ge({menuBg:l,menuHoverBg:v,menuActiveText:u,menuSubActiveText:m,menuSubBg:C,menuText:h,form:a}),a.value.elTheme===1&&(U(l),B(h)),a.value.elBg=l,a.value.elText=h}async function ke(){const{data:r}=await Je();R.value=r.map(l=>(l.id=l.id.toString(),l))}async function Ve(){const{data:r}=await Qe();I.value=r}function be(r){if(r.admin===1)return"总管理";let l=I.value.filter(v=>v.id==r.moreId);return l.length==0?"“账号不存在”":l[0].name}return $e(async()=>{Y(ze),ke(),await Ve()}),(r,l)=>{const v=s("FormScreen"),u=s("el-button"),m=s("el-table-column"),C=s("el-tag"),h=s("el-image"),ye=s("el-table"),we=s("pagination"),P=s("el-input"),b=s("el-form-item"),$=s("el-option"),q=s("el-select"),L=s("el-form"),O=s("el-dialog"),_=s("el-color-picker"),c=s("el-col"),j=s("el-row"),xe=s("el-switch"),Te=s("question-filled"),Ce=s("el-icon"),he=s("el-tooltip"),E=Pe("loading");return i(),S("div",Ze,[t(v,{options:o(ne),onSearch:o(ee)},null,8,["options","onSearch"]),t(u,{class:"mb10",icon:"Plus",type:"primary",plain:"",onClick:ie},{default:n(()=>[d("添加用户")]),_:1}),z((i(),p(ye,{data:o(Z),style:{width:"100%"}},{default:n(()=>[t(m,{label:"编号",align:"center",prop:"id"}),t(m,{label:"用户名称",align:"center",prop:"name"},{default:n(e=>[d(qe(e.row.name)+" ",1),e.row.admin===1?(i(),p(C,{key:0,size:"small",effect:"dark"},{default:n(()=>[d("超级管理员")]),_:1})):T("",!0)]),_:1}),t(m,{label:"用户头像",align:"center",prop:"url",width:"120"},{default:n(e=>[t(h,{style:{width:"100px",height:"100px"},src:o(g).fileHost+e.row.url,"preview-src-list":[o(g).fileHost+e.row.url],fit:"cover","preview-teleported":!0},null,8,["src","preview-src-list"])]),_:1}),t(m,{label:"状态",align:"center",prop:"name"},{default:n(e=>[e.row.status===1?(i(),p(C,{key:0,size:"small",effect:"dark"},{default:n(()=>[d("正常")]),_:1})):(i(),p(C,{key:1,size:"small",effect:"dark",type:"danger"},{default:n(()=>[d("禁用")]),_:1}))]),_:1}),t(m,{label:"账号归属",align:"center",prop:"name",formatter:be}),t(m,{label:"备注",align:"center",prop:"remark"}),t(m,{label:"创建时间",align:"center",prop:"createTime"}),t(m,{label:"操作",align:"center",width:"350"},{default:n(e=>[e.row.admin!==1?(i(),p(u,{key:0,link:"",size:"small",type:"primary",onClick:D=>ue(e.row),icon:"Edit"},{default:n(()=>[d("修改")]),_:2},1032,["onClick"])):T("",!0),t(u,{link:"",size:"small",type:"warning",onClick:D=>pe(e.row),icon:"Edit"},{default:n(()=>[d("修改密码")]),_:2},1032,["onClick"]),t(u,{link:"",size:"small",type:"success",onClick:D=>ce(e.row),icon:"Orange"},{default:n(()=>[d("主题修改")]),_:2},1032,["onClick"]),e.row.admin!==1?(i(),p(u,{key:1,link:"",size:"small",type:"danger",onClick:D=>me(e.row),icon:"Delete"},{default:n(()=>[d("删除")]),_:2},1032,["onClick"])):T("",!0)]),_:1})]),_:1},8,["data"])),[[E,o(le)]]),z(t(we,{total:o(M),page:o(A).page,"onUpdate:page":l[0]||(l[0]=e=>o(A).page=e),limit:o(A).size,"onUpdate:limit":l[1]||(l[1]=e=>o(A).size=e),onPagination:o(F)},null,8,["total","page","limit","onPagination"]),[[Ee,o(M)>0]]),t(O,{title:"用户管理",modelValue:o(V),"onUpdate:modelValue":l[10]||(l[10]=e=>G(V)?V.value=e:null),width:"500px"},{footer:n(()=>[z((i(),S("div",el,[t(u,{onClick:l[9]||(l[9]=e=>V.value=!1)},{default:n(()=>[d("取 消")]),_:1}),t(u,{type:"primary",onClick:de},{default:n(()=>[d("确 定")]),_:1})])),[[E,o(w)]])]),default:n(()=>[t(L,{class:"demo-form-inline","label-width":"80px",model:o(a),rules:o(se),ref:"ruleForm"},{default:n(()=>[t(b,{label:"用户名称",prop:"name"},{default:n(()=>[t(P,{modelValue:o(a).name,"onUpdate:modelValue":l[2]||(l[2]=e=>o(a).name=e),placeholder:"请输入用户名称"},null,8,["modelValue"])]),_:1}),o(a).id?T("",!0):(i(),p(b,{key:0,label:"用户密码",prop:"pwd"},{default:n(()=>[t(P,{modelValue:o(a).pwd,"onUpdate:modelValue":l[3]||(l[3]=e=>o(a).pwd=e),placeholder:"请输入密码"},null,8,["modelValue"])]),_:1})),t(b,{label:"用户头像",prop:"url"},{default:n(()=>[t(We,{modelValue:o(a).url,"onUpdate:modelValue":l[4]||(l[4]=e=>o(a).url=e),selectNum:1,selectAccept:".jpg,.png,.jpeg,.webp,.gif"},null,8,["modelValue"])]),_:1}),t(b,{label:"状态",prop:"status"},{default:n(()=>[t(q,{modelValue:o(a).status,"onUpdate:modelValue":l[5]||(l[5]=e=>o(a).status=e),placeholder:"请选择状态"},{default:n(()=>[t($,{label:"正常",value:1}),t($,{label:"禁用",value:0})]),_:1},8,["modelValue"])]),_:1}),o(a).admin!==1?(i(),p(b,{key:1,label:"角色选择",prop:"rolesId"},{default:n(()=>[t(q,{modelValue:o(a).rolesId,"onUpdate:modelValue":l[6]||(l[6]=e=>o(a).rolesId=e),filterable:"",placeholder:"请选择角色",multiple:""},{default:n(()=>[(i(!0),S(K,null,X(o(R),e=>(i(),p($,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):T("",!0),o(a).admin!==1?(i(),p(b,{key:2,label:"账号归属",prop:"moreId"},{default:n(()=>[t(q,{modelValue:o(a).moreId,"onUpdate:modelValue":l[7]||(l[7]=e=>o(a).moreId=e),filterable:"",placeholder:"请选择账号"},{default:n(()=>[(i(!0),S(K,null,X(o(I),e=>(i(),p($,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):T("",!0),t(b,{label:"备注说明"},{default:n(()=>[t(P,{modelValue:o(a).remark,"onUpdate:modelValue":l[8]||(l[8]=e=>o(a).remark=e),type:"textarea",placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),t(O,{title:"主题修改",modelValue:o(y),"onUpdate:modelValue":l[29]||(l[29]=e=>G(y)?y.value=e:null),width:"800",onClose:ve},{footer:n(()=>[z((i(),S("div",ul,[t(u,{onClick:l[28]||(l[28]=e=>y.value=!1)},{default:n(()=>[d("取 消")]),_:1}),t(u,{type:"primary",onClick:fe},{default:n(()=>[d("确认修改")]),_:1})])),[[E,o(w)]])]),default:n(()=>[t(L,{class:"demo-form-inline","label-width":"80px",model:o(a),ref:"themeForm"},{default:n(()=>[f("div",{style:{"text-align":"center","margin-bottom":"30px"},onClick:_e},[t(u,{type:"primary",size:"small",plain:""},{default:n(()=>[d("恢复默认主题")]),_:1})]),t(j,{style:{"text-align":"center"}},{default:n(()=>[t(c,{span:4},{default:n(()=>[ll,t(_,{modelValue:o(a).menuBg,"onUpdate:modelValue":l[11]||(l[11]=e=>o(a).menuBg=e),onChange:l[12]||(l[12]=e=>x(e,"--menuBg-color")),class:"color-picker","popper-class":"theme-picker-dropdown"},null,8,["modelValue"])]),_:1}),t(c,{span:4},{default:n(()=>[tl,t(_,{modelValue:o(a).menuSubBg,"onUpdate:modelValue":l[13]||(l[13]=e=>o(a).menuSubBg=e),onChange:l[14]||(l[14]=e=>x(e,"--menuSubBg-color")),class:"color-picker","popper-class":"theme-picker-dropdown"},null,8,["modelValue"])]),_:1}),t(c,{span:4},{default:n(()=>[ol,t(_,{modelValue:o(a).menuText,"onUpdate:modelValue":l[15]||(l[15]=e=>o(a).menuText=e),onChange:l[16]||(l[16]=e=>x(e,"--menuText-color")),class:"color-picker","popper-class":"theme-picker-dropdown"},null,8,["modelValue"])]),_:1}),t(c,{span:4},{default:n(()=>[al,t(_,{modelValue:o(a).menuActiveText,"onUpdate:modelValue":l[17]||(l[17]=e=>o(a).menuActiveText=e),onChange:l[18]||(l[18]=e=>x(e,"--menuActiveText-color")),class:"color-picker","popper-class":"theme-picker-dropdown"},null,8,["modelValue"])]),_:1}),t(c,{span:4},{default:n(()=>[nl,t(_,{modelValue:o(a).menuSubActiveText,"onUpdate:modelValue":l[19]||(l[19]=e=>o(a).menuSubActiveText=e),onChange:l[20]||(l[20]=e=>x(e,"--menuSubActiveText-color")),class:"color-picker","popper-class":"theme-picker-dropdown"},null,8,["modelValue"])]),_:1}),t(c,{span:4},{default:n(()=>[rl,t(_,{modelValue:o(a).menuHoverBg,"onUpdate:modelValue":l[21]||(l[21]=e=>o(a).menuHoverBg=e),onChange:l[22]||(l[22]=e=>x(e,"--menuHoverBg-color")),class:"color-picker","popper-class":"theme-picker-dropdown"},null,8,["modelValue"])]),_:1})]),_:1}),t(j,{justify:"end",align:"middle",style:{"text-align":"center","margin-top":"20px"}},{default:n(()=>[t(c,{span:3},{default:n(()=>[sl,t(_,{modelValue:o(a).elBg,"onUpdate:modelValue":l[23]||(l[23]=e=>o(a).elBg=e),onChange:l[24]||(l[24]=e=>H(e,1)),class:"color-picker","popper-class":"theme-picker-dropdown"},null,8,["modelValue"])]),_:1}),t(c,{span:3},{default:n(()=>[il,t(_,{modelValue:o(a).elText,"onUpdate:modelValue":l[25]||(l[25]=e=>o(a).elText=e),onChange:l[26]||(l[26]=e=>H(e,2)),class:"color-picker","popper-class":"theme-picker-dropdown"},null,8,["modelValue"])]),_:1}),t(c,{span:4},{default:n(()=>[t(xe,{modelValue:o(a).elTheme,"onUpdate:modelValue":l[27]||(l[27]=e=>o(a).elTheme=e),"active-text":"开启el主题跟随","inactive-text":"关闭el主题跟随","inline-prompt":"","active-value":1,"inactive-value":0,onChange:ge},null,8,["modelValue"])]),_:1}),t(he,{content:"开启后el的默认主题会跟随目前设置的主题颜色",placement:"top"},{default:n(()=>[t(Ce,null,{default:n(()=>[t(Te)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});export{Vl as default};

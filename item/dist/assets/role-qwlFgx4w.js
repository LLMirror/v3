import{a as ie,r as u,N as re,X as de,H as ue,al as me,b as s,d as pe,o as g,c as S,f as t,h as a,g as o,k as d,l as K,z,x as D,O as A,e as B,M as ce,A as U,E as fe,am as _e,K as ge,an as ve,ao as ye,t as be,ac as ke}from"./index-Dom6VubR.js";import{U as he}from"./UsePagination-DJeUD4p2.js";const Ce={class:"app-container table-height-auto"},we={key:0},Ve={class:"dialog-footer"},xe=fe({name:"Role"}),Ue=Object.assign(xe,{setup(Re){ie();const{initData:M,dataList:O,pageSearch:P,total:F,pageConfig:v,tableLoading:q,pageRefresh:h}=he(),{proxy:c}=be(),I=u([{label:"角色名称",prop:"name",type:"FormInput",placeholder:"请输入角色名称"},{label:"权限字符",prop:"roleKey",type:"FormInput",placeholder:"请输入权限字符"}]),m=u(!1),C=u(!1),w=u(""),y=u([]),b=u(!1),k=u(!1),p=u(null),L=re({form:{},rules:{name:[{required:!0,message:"角色名称不能为空",trigger:"blur"}]}}),{form:i,rules:j}=de(L);async function N(){const{data:n}=await ke(),{routerMenu:e}=n;y.value=e}async function H(n){await c.$modal.confirm(`是否确认删除角色：${n.name}?`),await _e({id:n.id}),h(),c.$modal.msgSuccess("删除成功")}function V(){p.value!=null&&p.value.setCheckedKeys([]),b.value=!1,k.value=!1,i.value={id:void 0,name:void 0,roleKey:void 0},c.resetForm("ruleForm")}function X(){V(),N(),m.value=!0,w.value="添加角色"}async function G(n){V(),await N();const{roles:e}=n,f=e.split(",");i.value={...n},m.value=!0,w.value="修改角色",f.forEach(r=>{ge(()=>{p.value.setChecked(r,!0,!1)})})}async function J(){await c.$refs.ruleForm.validate(),C.value=!0;try{const n=p.value.getCheckedNodes(!1,!0).map(e=>e.id);if(n.length===0)return c.$modal.msgError("请选择角色权限！");!i.value.id&&await ve({...i.value,roles:n.toString()}),i.value.id&&await ye({...i.value,roles:n.toString()}),c.$modal.msgSuccess(i.value.id?"修改成功":"新增成功"),h(),m.value=!1,V()}finally{C.value=!1}}function Q(n,e){if(e=="menu"){let f=y.value;for(let r=0;r<f.length;r++)p.value.store.nodesMap[f[r].id].expanded=n}}function W(n,e){e=="menu"&&p.value.setCheckedNodes(n?y.value:[])}return ue(()=>{M(me)}),(n,e)=>{const f=s("FormScreen"),r=s("el-button"),_=s("el-table-column"),Y=s("el-tag"),x=s("el-tooltip"),Z=s("el-table"),ee=s("pagination"),$=s("el-input"),R=s("el-form-item"),le=s("question-filled"),te=s("el-icon"),E=s("el-checkbox"),ae=s("el-tree"),oe=s("el-form"),ne=s("el-dialog"),T=pe("loading");return g(),S("div",Ce,[t(f,{options:a(I),onSearch:a(P)},null,8,["options","onSearch"]),t(r,{type:"primary",plain:"",icon:"Plus",onClick:X,class:"mb10"},{default:o(()=>[d("新增 ")]),_:1}),K((g(),z(Z,{data:a(O)},{default:o(()=>[t(_,{label:"角色编号",prop:"id",width:"120",align:"center"}),t(_,{label:"角色名称",prop:"name",align:"center"},{default:o(l=>[d(D(l.row.name)+" ",1),l.row.roleKey==="admin"?(g(),z(Y,{key:0,size:"mini",effect:"dark"},{default:o(()=>[d("超级管理员 ")]),_:1})):A("",!0)]),_:1}),t(_,{label:"权限字符",prop:"roleKey"}),t(_,{label:"创建时间",align:"center",prop:"createTime"},{default:o(l=>[B("span",null,D(n.parseTime(l.row.createTime)),1)]),_:1}),t(_,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:o(l=>[l.row.roleKey!=="admin"?(g(),S("div",we,[t(x,{content:"修改",placement:"top"},{default:o(()=>[t(r,{link:"",type:"primary",icon:"Edit",size:"small",onClick:se=>G(l.row)},{default:o(()=>[d("修改")]),_:2},1032,["onClick"])]),_:2},1024),t(x,{content:"删除",placement:"top"},{default:o(()=>[t(r,{link:"",type:"danger",icon:"Delete",size:"small",onClick:se=>H(l.row)},{default:o(()=>[d("删除")]),_:2},1032,["onClick"])]),_:2},1024)])):A("",!0)]),_:1})]),_:1},8,["data"])),[[T,a(q)]]),K(t(ee,{total:a(F),page:a(v).page,"onUpdate:page":e[0]||(e[0]=l=>a(v).page=l),limit:a(v).size,"onUpdate:limit":e[1]||(e[1]=l=>a(v).size=l),onPagination:a(h)},null,8,["total","page","limit","onPagination"]),[[ce,a(F)>0]]),t(ne,{title:a(w),modelValue:a(m),"onUpdate:modelValue":e[9]||(e[9]=l=>U(m)?m.value=l:null),width:"700px","append-to-body":""},{footer:o(()=>[K((g(),S("div",Ve,[t(r,{onClick:e[8]||(e[8]=l=>m.value=!1)},{default:o(()=>[d("取 消")]),_:1}),t(r,{type:"primary",onClick:J},{default:o(()=>[d("确 定")]),_:1})])),[[T,a(C)]])]),default:o(()=>[t(oe,{ref:"ruleForm",model:a(i),rules:a(j),"label-width":"100px"},{default:o(()=>[t(R,{label:"角色名称",prop:"name"},{default:o(()=>[t($,{modelValue:a(i).name,"onUpdate:modelValue":e[2]||(e[2]=l=>a(i).name=l),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),t(R,{prop:"roleKey"},{label:o(()=>[B("span",null,[t(x,{content:"可用于各种权限判断处理，比如自定义指令：v-hasRole=['权限值']",placement:"top"},{default:o(()=>[t(te,null,{default:o(()=>[t(le)]),_:1})]),_:1}),d(" 权限字符 ")])]),default:o(()=>[t($,{modelValue:a(i).roleKey,"onUpdate:modelValue":e[3]||(e[3]=l=>a(i).roleKey=l),placeholder:"请输入权限字符"},null,8,["modelValue"])]),_:1}),t(R,{label:"菜单权限"},{default:o(()=>[t(E,{modelValue:a(b),"onUpdate:modelValue":e[4]||(e[4]=l=>U(b)?b.value=l:null),onChange:e[5]||(e[5]=l=>Q(l,"menu"))},{default:o(()=>[d("展开/折叠")]),_:1},8,["modelValue"]),t(E,{modelValue:a(k),"onUpdate:modelValue":e[6]||(e[6]=l=>U(k)?k.value=l:null),onChange:e[7]||(e[7]=l=>W(l,"menu"))},{default:o(()=>[d("全选/全不选 ")]),_:1},8,["modelValue"]),t(ae,{class:"tree-border",data:a(y),"show-checkbox":"",ref_key:"menuRef",ref:p,"node-key":"id","check-strictly":!1,"empty-text":"加载中，请稍候",props:{label:"title",children:"children"}},null,8,["data"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}}});export{Ue as default};

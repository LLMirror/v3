import{_ as sl,r as d,N as il,X as ol,w as ge,aF as B,v as ul,b as c,d as ye,o,c as m,f as s,g as i,e as r,x as $,O as g,k,z as _,l as P,F as ee,C as _e,h as l,P as he,m as cl,A as D,j as dl,aG as rl,aH as ml,M as fl,t as vl,p as pl,n as gl}from"./index-Dom6VubR.js";import{U as yl,_ as ke,i as _l,j as hl,k as kl,l as wl,m as we,n as xl,o as bl}from"./index-AsNyoiPZ.js";import{U as Nl}from"./UsePagination-DJeUD4p2.js";const Z=n=>(pl("data-v-6aefbc3e"),n=n(),gl(),n),Cl={class:"menu-box"},Vl={key:0,class:"menu-title"},Sl=["onClick"],Il={class:"menu-name"},$l={key:0,class:"menu-empty"},Al={class:"img-box"},Ml={class:"img-search"},Fl={class:"img-list"},zl={key:1},Ul={key:2,class:"no-img"},Bl=["onClick","title"],Dl={key:0,class:"select-icon"},Tl=["title"],El={class:"img-item-icon"},Rl={key:0,class:"img-empty"},Ll={class:"img-pagination"},Pl={class:"dialog-footer"},jl={key:0,class:"select_type"},Hl={class:"dialog-footer"},Ol={class:"del-name-hint"},Kl=Z(()=>r("div",null,"确认删除文件:",-1)),Zl=Z(()=>r("span",null," ？",-1)),ql={class:"del-name-hint"},Gl=Z(()=>r("div",null,"文件完整地址:",-1)),Wl=Z(()=>r("div",{class:"del-text-hint"},[r("div",null,"删除后，所有引用此文件都将失效，并且无法恢复。请再次确认是否删除！")],-1)),Xl={class:"dialog-footer"},Jl={__name:"index",props:{modelValue:[String,Array],runType:{type:String,default:"arrayObj"},isMore:{type:Boolean,default:!1},selectNum:{type:Number,default:0},itemName:{type:String,default:"url"},accept:{type:String,default:""},selectAccept:{type:String,default:""},size:{type:Number,default:0},limit:{type:Number,default:0},multiple:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},isCompress:{type:Boolean,default:!1},showDeleteMore:{type:Boolean,default:!0},moreFileNum:{type:Number||void 0,default:void 0},title:{type:String,default:"文件库"},classTitle:{type:String,default:"文件分类"},classAllName:{type:String,default:"全部文件"},fileBtnText:{type:String,default:"点击上传"},msgName:{type:String,default:"文件"}},emits:["update:modelValue","imgAdminRes"],setup(n,{expose:xe,emit:be}){const{initData:Ne,dataList:C,pageSearch:le,total:te,setDataParams:Ce,setPageConfig:Ve,pageConfig:j,pageRefresh:H,callFun:Se}=Nl(),u=n,{proxy:v}=vl(),ae=be,z=d(!1),V=d(!1),U=d(0),T=d(0),h=d(0),b=d([]),N=d(!1),S=d(!1),q=d(!1),ne=d(0),G=d([]),E=d(0),A=d(""),R=d(!1),se=d(""),M=d(!1),O=d({}),I=d(!1),f=d([]),Ie=il({form:{},rules:{name:[{required:!0,message:"分类名称不能为空",trigger:"blur"}]}}),{form:p,rules:$e}=ol(Ie);ge(()=>u.modelValue,t=>{if(t){const e=Array.isArray(t)?t:u.modelValue.split(",");E.value=e.length}else return E.value=0},{deep:!0,immediate:!0}),ge(()=>C.value,t=>{G.value=t.filter(e=>B(e[u.itemName])===1).map(e=>v.fileHost+e[u.itemName])}),Se.lastCallback=()=>{f.value=f.value.filter(t=>C.value.findIndex(e=>e.id===t)>=0),u.selectAccept&&C.value.forEach(t=>{const e=u.selectAccept.split(",").map(y=>y.replace(".","\\.")).join("|"),w=new RegExp(`(${e})$`,"i");t.isSelect=!w.test(t[u.itemName])}),re()};const ie=ul(()=>u.selectNum===0||u.selectNum-E.value>1),Ae=t=>{if(t){f.value=C.value.filter(e=>!e.isSelect).map(e=>e.id),f.value.length===0&&(I.value=!1);return}f.value=[]},W=()=>{Q(),le()},X=()=>{A.value="",I.value=!1,Q(),le()};async function J(){try{S.value=!0;const{data:t}=await xl({isMore:u.isMore});return b.value=[{name:u.classAllName,id:""},...t],b.value}finally{S.value=!1}}const Q=()=>{Ce({menuId:h.value,name:A.value,moreFileNum:u.moreFileNum,isMore:u.isMore})};async function oe(){try{N.value=!0,Ve({size:15}),Q(),I.value=!1,await Ne(bl)}finally{N.value=!1}}function Me(){V.value=!0,p.value={sort:0}}async function Fe(){await v.$refs.formRef.validate();try{S.value=!0;const{id:t}=p.value;if(t&&await _l({...p.value}),!t){const{data:e}=await hl({...p.value,isMore:u.isMore});h.value=e.insertId,A.value="",oe()}v.$modal.msgSuccess(t?"修改成功":"新增成功！"),V.value=!1,await J(),ue()}finally{S.value=!1}}function ze(t,e){U.value=e,h.value=t.id,X()}function Ue(t,e){p.value={...t},T.value=e,V.value=!0}async function Be(){await v.$modal.confirm(`确认删除分类：${p.value.name||""} ？`);try{S.value=!0,await kl(p.value),v.$modal.msgSuccess("删除成功！"),V.value=!1,await J(),A.value="",T.value==U.value?(T.value=U.value=0,h.value=b.value[0].id,X()):ue()}finally{S.value=!1}}function ue(){const t=b.value.findIndex(e=>e.id==h.value);t!==-1?T.value=U.value=t:(T.value=h.value=0,h.value=b.value[0].id,X())}async function De(t){try{N.value=!0,await wl({imgArr:t.map(e=>({...e,menuId:h.value,type:B(e.url)})),isMore:u.isMore}),I.value=!1,H()}finally{N.value=!1}}function ce(t){const e=v.fileHost+t,w=G.value.findIndex(y=>y===e);switch(w>=0&&(ne.value=w),B(e)){case 1:q.value=!0;break;case 2:se.value=e,R.value=!0;break;case 3:window.open(e,"_blank");break}}function Te(t){O.value=t,M.value=!0}async function Ee(){try{N.value=!0,await we({id:[O.value.id]}),M.value=!1,H(),v.$modal.msgSuccess("删除成功！")}finally{N.value=!1}}function Re(t){const e=f.value.findIndex(w=>w===t.id);if(e>=0)f.value.splice(e,1);else{if(u.selectNum!==0&&f.value.length>=u.selectNum-E.value)return v.$modal.msgError(`一次性最多选择${u.selectNum-E.value}个${u.msgName}`);f.value.push(t.id)}re(),ie.value||de()}function de(){if(f.value.length===0)return v.$modal.msgError(`请先选择${u.msgName}`);const t=f.value.reduce((e,w)=>[...e,...C.value.filter(y=>y.id===w)],[]);f.value=[],ae("update:modelValue",me(t)),ae("imgAdminRes",me(t)),z.value=!1}const Le=async()=>{await v.$modal.confirm(`是否确定删除 已选 ${u.msgName} ！！！`);try{N.value=!0,await we({id:f.value}),M.value=!1,H(),v.$modal.msgSuccess("删除成功！")}finally{N.value=!1}},re=()=>{const t=C.value.filter(e=>!e.isSelect);t.length>0&&(I.value=t.length===f.value.length)};function me(t){switch(u.runType){case"string":return t.map(e=>e[u.itemName]).join(",");case"arrayStr":return t.map(e=>e[u.itemName]);case"arrayObj":return t;default:return""}}function Pe(){v.$modal.msgError("当前配置禁止选择此文件")}async function je(){await J(),b.value.length>0&&(h.value=b.value[U.value].id),oe(),z.value=!0}return xe({showOpen:je}),(t,e)=>{const w=c("Edit"),y=c("el-icon"),He=c("el-scrollbar"),x=c("el-button"),fe=c("el-col"),ve=c("el-input"),Oe=c("el-checkbox"),Ke=c("el-image"),Ze=c("Document"),qe=c("el-text"),Ge=c("Select"),We=c("ZoomIn"),Xe=c("Download"),Je=c("Delete"),Qe=c("pagination"),Ye=c("el-row"),K=c("el-dialog"),pe=c("el-form-item"),el=c("el-input-number"),ll=c("el-form"),tl=c("el-image-viewer"),al=c("el-popconfirm"),Y=ye("loading"),nl=ye("number");return o(),m(ee,null,[s(K,{title:n.title,modelValue:l(z),"onUpdate:modelValue":e[5]||(e[5]=a=>D(z)?z.value=a:null),width:"750px","close-on-click-modal":!1,draggable:"","show-close":!1},{footer:i(()=>[r("div",Pl,[n.selectAccept&&!n.disabled?(o(),m("div",jl,"选择类型："+$(n.selectAccept),1)):g("",!0),s(x,{onClick:e[4]||(e[4]=a=>z.value=!1)},{default:i(()=>[k("关 闭")]),_:1}),n.disabled?g("",!0):(o(),_(x,{key:1,type:"primary",onClick:de},{default:i(()=>[k("确认选择")]),_:1}))])]),default:i(()=>[s(Ye,null,{default:i(()=>[s(fe,{span:5,style:{"text-align":"center"}},{default:i(()=>[P((o(),m("div",Cl,[n.classTitle?(o(),m("div",Vl,$(n.classTitle),1)):g("",!0),s(He,{height:"300px",class:"class-scrollbar"},{default:i(()=>[(o(!0),m(ee,null,_e(l(b),(a,F)=>(o(),m("div",{key:a.name,onClick:L=>ze(a,F),class:he(["menu-item",l(U)==F?"menu-active":""])},[r("div",Il,$(a.name),1),a.id?(o(),_(y,{key:0,onClick:cl(L=>Ue(a,F),["stop"]),class:"menu-icon",color:"#409eff"},{default:i(()=>[s(w)]),_:2},1032,["onClick"])):g("",!0)],10,Sl))),128)),l(b).length===0?(o(),m("div",$l,"暂无分类，请先添加")):g("",!0)]),_:1}),s(x,{onClick:Me,type:"primary",style:{width:"100%"},size:"small"},{default:i(()=>[k("新增分类")]),_:1})])),[[Y,l(S)]])]),_:1}),P((o(),_(fe,{span:19},{default:i(()=>[r("div",Al,[r("div",Ml,[s(ve,{size:"small",modelValue:l(A),"onUpdate:modelValue":e[0]||(e[0]=a=>D(A)?A.value=a:null),onKeyup:dl(W,["enter","native"]),onClear:W,placeholder:"请输入文件名",clearable:""},{append:i(()=>[s(x,{type:"primary",onClick:W},{default:i(()=>[k("搜索")]),_:1})]),_:1},8,["modelValue","onKeyup"]),!n.disabled&&n.selectNum===0?(o(),_(Oe,{key:0,class:"file-all-check",modelValue:l(I),"onUpdate:modelValue":e[1]||(e[1]=a=>D(I)?I.value=a:null),onChange:Ae,label:"全选"},null,8,["modelValue"])):g("",!0)]),l(h)&&!n.disabled?(o(),m("div",{key:0,class:he(["add-img-btn",{"add-img-btn-top":!n.title}])},[s(yl,{listType:"text",accept:n.accept,size:n.size,limit:n.limit,fileBtnText:n.fileBtnText,multiple:n.multiple,upData:{menuId:l(h)},isCompress:n.isCompress,onUploadSuccessImgAdmin:De,isClearFiles:""},null,8,["accept","size","limit","fileBtnText","multiple","upData","isCompress"])],2)):g("",!0),r("div",Fl,[(o(!0),m(ee,null,_e(l(C),(a,F)=>(o(),m("div",{class:"img-item",key:F,style:{width:"100px",height:"100px"}},[l(B)(a[n.itemName])===1?(o(),_(Ke,{key:0,style:{width:"100px",height:"100px"},src:l(v).fileHost+a[n.itemName],"preview-teleported":!0,fit:"contain"},null,8,["src"])):l(B)(a[n.itemName])===2?(o(),m("div",zl,[s(ke,{videoStyle:"width: 100px; height: 100px",url:l(v).fileHost+a[n.itemName]},null,8,["url"])])):(o(),m("div",Ul,[r("div",null,[s(y,{size:"18"},{default:i(()=>[s(Ze)]),_:1})]),s(qe,{type:"primary",size:"small"},{default:i(()=>[k($(l(rl)(l(ml)(a[n.itemName]))),1)]),_:2},1024)])),!a.isSelect&&!n.disabled?(o(),m("div",{key:3,onClick:L=>Re(a,F),class:"img-select-icon",title:a.name},[l(ie)?(o(),m("div",Dl,[l(f).includes(a.id)?(o(),_(y,{key:0,size:"12",color:"#409eff"},{default:i(()=>[s(Ge)]),_:1})):g("",!0)])):g("",!0)],8,Bl)):(o(),m("div",{key:4,class:"img-select-icon no-img-select",title:a.name,onClick:Pe},null,8,Tl)),r("div",El,[l(B)(a[n.itemName])!==3?(o(),_(y,{key:0,onClick:L=>ce(a[n.itemName],F),color:"#fff",size:"14",title:"放大",style:{cursor:"pointer"}},{default:i(()=>[s(We)]),_:2},1032,["onClick"])):(o(),_(y,{key:1,onClick:L=>ce(a[n.itemName]),size:"14",title:"下载",color:"#fff",style:{cursor:"pointer"}},{default:i(()=>[s(Xe)]),_:2},1032,["onClick"])),s(y,{onClick:L=>Te(a),color:"#f65276",size:"14",title:"删除",style:{cursor:"pointer"}},{default:i(()=>[s(Je)]),_:2},1032,["onClick"])])]))),128))])]),l(C).length===0?(o(),m("div",Rl,"当前分类"+$(n.msgName)+"为空~",1)):g("",!0),r("div",Ll,[P(s(Qe,{layout:"total,prev, pager, next",total:l(te),page:l(j).page,"onUpdate:page":e[2]||(e[2]=a=>l(j).page=a),limit:l(j).size,"onUpdate:limit":e[3]||(e[3]=a=>l(j).size=a),onPagination:l(H),small:"","pager-count":4},null,8,["total","page","limit","onPagination"]),[[fl,l(te)>0]])])]),_:1})),[[Y,l(N)]]),n.showDeleteMore&&l(f).length>0?(o(),_(x,{key:0,class:"flex-all-delete",size:"small",type:"danger",onClick:Le},{default:i(()=>[k("删除")]),_:1})):g("",!0)]),_:1})]),_:1},8,["title","modelValue"]),s(K,{title:"分类管理",modelValue:l(V),"onUpdate:modelValue":e[9]||(e[9]=a=>D(V)?V.value=a:null),width:"400px","append-to-body":"","close-on-click-modal":!1},{footer:i(()=>[P((o(),m("div",Hl,[s(x,{onClick:e[8]||(e[8]=a=>V.value=!1),size:"small"},{default:i(()=>[k("关 闭")]),_:1}),l(p).id?(o(),_(x,{key:0,onClick:Be,type:"danger",size:"small"},{default:i(()=>[k("删除")]),_:1})):g("",!0),s(x,{type:"primary",onClick:Fe,size:"small"},{default:i(()=>[k($(l(p).id?"修改":"新增"),1)]),_:1})])),[[Y,l(S)]])]),default:i(()=>[s(ll,{ref:"formRef",model:l(p),rules:l($e),"label-width":"100px"},{default:i(()=>[s(pe,{label:"分类名称",prop:"name"},{default:i(()=>[s(ve,{modelValue:l(p).name,"onUpdate:modelValue":e[6]||(e[6]=a=>l(p).name=a),maxLength:"6",placeholder:"请输入分类名称"},null,8,["modelValue"])]),_:1}),s(pe,{label:"展示排序",prop:"sort"},{default:i(()=>[P(s(el,{modelValue:l(p).sort,"onUpdate:modelValue":e[7]||(e[7]=a=>l(p).sort=a),placeholder:"请输入展示排序"},null,8,["modelValue"]),[[nl,{value:3,call:a=>l(p).sort=a}]])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),l(q)?(o(),_(tl,{key:0,"initial-index":l(ne),"preview-teleported":!0,onClose:e[10]||(e[10]=()=>{q.value=!1}),"url-list":l(G)},null,8,["initial-index","url-list"])):g("",!0),s(K,{modelValue:l(R),"onUpdate:modelValue":e[11]||(e[11]=a=>D(R)?R.value=a:null),size:"tiny","append-to-body":"",width:"50%"},{default:i(()=>[l(R)?(o(),_(ke,{key:0,url:l(se),videoStyle:"width: 100%;height: 700px"},null,8,["url"])):g("",!0)]),_:1},8,["modelValue"]),s(K,{modelValue:l(M),"onUpdate:modelValue":e[13]||(e[13]=a=>D(M)?M.value=a:null),title:"危险提醒",width:"520"},{footer:i(()=>[r("div",Xl,[s(x,{onClick:e[12]||(e[12]=a=>M.value=!1)},{default:i(()=>[k("取消")]),_:1}),s(al,{title:"确定永久删除？",onConfirm:Ee},{reference:i(()=>[s(x,{type:"danger"},{default:i(()=>[k("永久删除")]),_:1})]),_:1})])]),default:i(()=>[r("div",null,[r("div",Ol,[Kl,r("p",null,$(l(O).name||""),1),Zl]),r("div",ql,[Gl,r("span",null,$(l(v).fileHost+l(O)[u.itemName]||""),1)]),Wl])]),_:1},8,["modelValue"])],64)}}},lt=sl(Jl,[["__scopeId","data-v-6aefbc3e"]]);export{lt as F};
